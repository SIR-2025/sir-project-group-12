{
  "flow": {
    "flow": {
      "flowId": "cdd9bb65-1f3e-4796-830d-2fc649a9ddc6",
      "displayName": "SIR_flow",
      "transitionEvents": [ {
        "triggerIntentId": "8987495b-e634-4be2-a7cf-26a5e2b89908",
        "transitionEventHandler": {
          "beforeTransition": {
          
          },
          "targetPageId": "d786ec7c-ba01-4d71-b1a0-57a1d4b2f5ed"
        },
        "name": "8ebf9cc2-7a97-4caf-a6f8-e27f8807882b"
      }, {
        "condition": {
          "restriction": {
            "comparator": "GLOBAL",
            "rhs": {
              "value": "true"
            }
          }
        },
        "transitionEventHandler": {
          "beforeTransition": {
            "setParameterActions": [ {
              "parameter": "current_cycle",
              "value": 1
            }, {
              "parameter": "story_theme",
              "value": "Snow White"
            } ]
          },
          "targetPageId": "d786ec7c-ba01-4d71-b1a0-57a1d4b2f5ed"
        },
        "name": "ca381e69-04ee-4c17-8334-8d62692725e5",
        "conditionString": "true"
      } ],
      "modelIdentifier": {
        "modelId": "87051895-b310-4c10-825d-917012503751"
      },
      "conversationEvents": [ {
        "event": "sys.no-match-default",
        "handler": {
          "beforeTransition": {
            "staticUserResponse": {
              "candidates": [ {
                "selector": {
                  "platform": [ "PLATFORM_UNSPECIFIED" ],
                  "lang": "en"
                },
                "responses": [ {
                  "text": {
                    "variants": [ {
                      "text": "I didn't get that. Can you say it again?"
                    }, {
                      "text": "I missed what you said. What was that?"
                    }, {
                      "text": "Sorry, could you say that again?"
                    }, {
                      "text": "Sorry, can you say that again?"
                    }, {
                      "text": "Can you say that again?"
                    }, {
                      "text": "Sorry, I didn't get that. Can you rephrase?"
                    }, {
                      "text": "Sorry, what was that?"
                    }, {
                      "text": "One more time?"
                    }, {
                      "text": "What was that?"
                    }, {
                      "text": "Say that one more time?"
                    }, {
                      "text": "I didn't get that. Can you repeat?"
                    }, {
                      "text": "I missed that, say that again?"
                    } ]
                  }
                } ]
              } ]
            }
          }
        },
        "name": "c241c1fa-81e9-4546-91a4-efb4afd7c1b2"
      }, {
        "event": "sys.no-input-default",
        "handler": {
          "beforeTransition": {
          
          },
          "targetPageId": "d786ec7c-ba01-4d71-b1a0-57a1d4b2f5ed"
        },
        "name": "9161e689-ae74-4940-a2e6-08da2456664b"
      } ],
      "nluSettings": {
        "classificationThreshold": 0.30000001,
        "modelType": "MODEL_TYPE_ADVANCED",
        "customConfigKey": "c8a6ebd1-57f0-4f82-b3d5-4d1584033a47"
      },
      "etag": "691ef797",
      "nluSettingsMapping": [ {
        "key": "en",
        "value": {
          "classificationThreshold": 0.30000001,
          "modelType": "MODEL_TYPE_ADVANCED",
          "customConfigKey": "c8a6ebd1-57f0-4f82-b3d5-4d1584033a47",
          "languageCode": "en"
        }
      } ]
    },
    "intents": [ {
      "meta": {
        "id": "8987495b-e634-4be2-a7cf-26a5e2b89908",
        "displayName": "start_intent",
        "priority": 500000,
        "parameters": [ {
          "id": "date-time",
          "displayName": "date-time",
          "value": "$date-time",
          "entityTypeDisplayName": "@sys.date-time"
        } ],
        "etag": "691ef6bb"
      },
      "trainingPhrases": [ {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "I'm going to start a story now.",
          "userDefined": true
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "I'm here to tell a story.",
          "userDefined": true
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "Hi, let me tell you a story",
          "userDefined": true
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "Hello! I will tell a story "
        }, {
          "text": "today",
          "entityType": "@sys.date-time",
          "alias": "date-time"
        }, {
          "text": "."
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      } ]
    }, {
      "meta": {
        "id": "00000000-0000-0000-0000-000000000001",
        "displayName": "Default Negative Intent",
        "priority": 500000,
        "isFallback": true
      },
      "trainingPhrases": [ {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "What's your zodiac sign?"
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "I'd like to order a ",
          "userDefined": true
        }, {
          "text": "burger"
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "What is your gender?"
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      }, {
        "type": "EXAMPLE",
        "parts": [ {
          "text": "What's your favorite color?"
        } ],
        "timesAddedCount": 1,
        "lang": "en"
      } ]
    } ],
    "pages": [ {
      "key": "86186d4a-b1c6-4139-b6af-9e00ce749bab",
      "value": {
        "displayName": "End Session",
        "etag": "691eef98"
      }
    }, {
      "key": "aa58aea7-d2a4-42d1-a475-6be63358d3a9",
      "value": {
        "displayName": "Data_Collection",
        "onLoad": {
          "staticUserResponse": {
            "candidates": [ {
              "selector": {
                "platform": [ "PLATFORM_UNSPECIFIED" ],
                "lang": "en"
              },
              "responses": [ {
                "text": {
                  "variants": [ {
                    "text": "$session.params.robot_speech"
                  } ]
                }
              } ]
            } ]
          },
          "generators": [ {
            "generatorId": "66324c87-ec43-4011-ba1e-a5f4f088d7b4",
            "inputParameters": [ {
              "key": "cycle_num",
              "value": "$session.params.current_cycle"
            }, {
              "key": "input_count",
              "value": "$session.params.input_counter"
            } ],
            "outputParameter": "robot_speech"
          } ]
        },
        "slots": [ {
          "displayName": "user_input",
          "mode": "REQUIRED",
          "type": {
            "className": "@sys.any",
            "classType": "BUILT_IN_CLASS"
          },
          "fillBehavior": {
            "initialPrompt": {
            
            }
          }
        } ],
        "transitionEvents": [ {
          "condition": {
            "conjunction": {
              "expressions": [ {
                "restriction": {
                  "comparator": "EQUALS",
                  "lhs": {
                    "member": {
                      "expressions": [ {
                        "value": "$page"
                      }, {
                        "value": "params"
                      }, {
                        "value": "status"
                      } ]
                    }
                  },
                  "rhs": {
                    "phrase": {
                      "values": [ "FINAL" ]
                    }
                  }
                }
              }, {
                "restriction": {
                  "comparator": "LESS_THAN_EQUALS",
                  "lhs": {
                    "member": {
                      "expressions": [ {
                        "value": "$session"
                      }, {
                        "value": "params"
                      }, {
                        "value": "input_counter"
                      } ]
                    }
                  },
                  "rhs": {
                    "value": "5"
                  }
                }
              } ]
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
              "setParameterActions": [ {
                "parameter": "collected_words",
                "value": "$session.params.collected_words + \", \" + $session.params.user_input"
              }, {
                "parameter": "input_counter",
                "value": "$session.params.input_counter + 1"
              }, {
                "parameter": "user_input",
                "value": null
              } ]
            },
            "targetPageId": "aa58aea7-d2a4-42d1-a475-6be63358d3a9"
          },
          "name": "40185c41-55a1-41d8-9ba4-66b3e2a22807",
          "conditionString": "$page.params.status = \"FINAL\" AND $session.params.input_counter \u003c= 5"
        }, {
          "condition": {
            "conjunction": {
              "expressions": [ {
                "restriction": {
                  "comparator": "EQUALS",
                  "lhs": {
                    "member": {
                      "expressions": [ {
                        "value": "$page"
                      }, {
                        "value": "params"
                      }, {
                        "value": "status"
                      } ]
                    }
                  },
                  "rhs": {
                    "phrase": {
                      "values": [ "FINAL" ]
                    }
                  }
                }
              }, {
                "restriction": {
                  "comparator": "GREATER_THAN",
                  "lhs": {
                    "member": {
                      "expressions": [ {
                        "value": "$session"
                      }, {
                        "value": "params"
                      }, {
                        "value": "input_counter"
                      } ]
                    }
                  },
                  "rhs": {
                    "value": "5"
                  }
                }
              } ]
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
              "setParameterActions": [ {
                "parameter": "collected_words",
                "value": "$session.params.collected_words + \", \" + $session.params.user_input"
              }, {
                "parameter": "input_counter",
                "value": "$session.params.input_counter + 1"
              }, {
                "parameter": "user_input",
                "value": null
              } ]
            },
            "targetPageId": "f970dbc0-cb60-470c-9281-96cac0f24d29"
          },
          "name": "e74855b3-d1eb-4ad2-80eb-4680cb34694f",
          "conditionString": "$page.params.status = \"FINAL\" AND $session.params.input_counter \u003e 5"
        } ],
        "etag": "691f0093"
      }
    }, {
      "key": "c0a1926b-7f16-4448-bc44-283c3650e010",
      "value": {
        "displayName": "Performance_Output",
        "onLoad": {
          "staticUserResponse": {
            "candidates": [ {
              "selector": {
                "platform": [ "PLATFORM_UNSPECIFIED" ],
                "lang": "en"
              },
              "responses": [ {
                "payload": {
                  "robot_command": {
                    "led": "$session.params.generator_output.led_color",
                    "motion": "$session.params.generator_output.motion_tag",
                    "text": "$session.params.generator_output.story_text"
                  }
                }
              } ]
            } ]
          },
          "setParameterActions": [ {
            "parameter": "current_cycle",
            "value": "$session.params.current_cycle + 1"
          }, {
            "parameter": "input_counter",
            "value": 1
          }, {
            "parameter": "collected_words",
            "value": ""
          }, {
            "parameter": "user_input",
            "value": null
          } ]
        },
        "transitionEvents": [ {
          "condition": {
            "restriction": {
              "comparator": "GLOBAL",
              "rhs": {
                "value": "true"
              }
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
            
            },
            "targetPageId": "d786ec7c-ba01-4d71-b1a0-57a1d4b2f5ed"
          },
          "name": "a04f4b56-0200-4e2a-9f13-20a7fb234b63",
          "conditionString": "true"
        } ],
        "etag": "691ef2b7"
      }
    }, {
      "key": "d786ec7c-ba01-4d71-b1a0-57a1d4b2f5ed",
      "value": {
        "displayName": "Cycle_Setup",
        "onLoad": {
          "staticUserResponse": {
            "candidates": [ {
              "selector": {
                "platform": [ "PLATFORM_UNSPECIFIED" ],
                "lang": "en"
              },
              "responses": [ {
                "text": {
                  "variants": [ {
                    "text": "$session.params.robot_speech"
                  } ]
                }
              } ]
            } ]
          },
          "generators": [ {
            "generatorId": "d615790b-cb2f-4cdd-8288-143fd0a263c7",
            "outputParameter": "robot_speech"
          } ]
        },
        "transitionEvents": [ {
          "condition": {
            "restriction": {
              "comparator": "GLOBAL",
              "rhs": {
                "value": "true"
              }
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
            
            },
            "targetPageId": "aa58aea7-d2a4-42d1-a475-6be63358d3a9"
          },
          "name": "1fa78583-4608-41f7-9673-8f1adc9e877c",
          "conditionString": "true"
        }, {
          "condition": {
            "restriction": {
              "comparator": "LESS_THAN_EQUALS",
              "lhs": {
                "member": {
                  "expressions": [ {
                    "value": "$session"
                  }, {
                    "value": "params"
                  }, {
                    "value": "current_cycle"
                  } ]
                }
              },
              "rhs": {
                "value": "4"
              }
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
            
            },
            "targetPageId": "aa58aea7-d2a4-42d1-a475-6be63358d3a9"
          },
          "name": "bbee34c1-1736-4479-821b-f3f7fb29efdc",
          "conditionString": "$session.params.current_cycle \u003c= 4"
        }, {
          "condition": {
            "restriction": {
              "comparator": "GREATER_THAN",
              "lhs": {
                "member": {
                  "expressions": [ {
                    "value": "$session"
                  }, {
                    "value": "params"
                  }, {
                    "value": "current_cycle"
                  } ]
                }
              },
              "rhs": {
                "value": "4"
              }
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
            
            },
            "targetPageId": "86186d4a-b1c6-4139-b6af-9e00ce749bab"
          },
          "name": "33389489-d5d9-4770-a5d5-234cceda06a2",
          "conditionString": "$session.params.current_cycle \u003e 4"
        } ],
        "etag": "691effa9"
      }
    }, {
      "key": "f970dbc0-cb60-470c-9281-96cac0f24d29",
      "value": {
        "displayName": "Narrative_Generation",
        "onLoad": {
          "generators": [ {
            "generatorId": "90e44160-eb2b-4b2f-ae81-df5a4bc8edce",
            "inputParameters": [ {
              "key": "collected_words",
              "value": "$session.params.collected_words"
            }, {
              "key": "cycle_num",
              "value": "$session.params.current_cycle"
            } ],
            "outputParameter": "generator_output"
          } ]
        },
        "transitionEvents": [ {
          "condition": {
            "restriction": {
              "comparator": "GLOBAL",
              "rhs": {
                "value": "true"
              }
            }
          },
          "transitionEventHandler": {
            "beforeTransition": {
            
            },
            "targetPageId": "c0a1926b-7f16-4448-bc44-283c3650e010"
          },
          "name": "ac8b1851-6723-4acb-a9f5-899b1b087b10",
          "conditionString": "true"
        } ],
        "etag": "691f001a"
      }
    } ],
    "generators": [ {
      "key": "66324c87-ec43-4011-ba1e-a5f4f088d7b4",
      "value": {
        "id": "66324c87-ec43-4011-ba1e-a5f4f088d7b4",
        "displayName": "Question_Gen",
        "phrases": [ {
          "text": "Context: Cycle: $cycle_num. Question Number: $input_count. Task: Ask the specific question for this step in the Snow White script.\n\nScript Logic: IF Cycle 1:\nQ1: \"Name an adjective a vain Queen would want to be.\"\nQ2: \"Name a weird object to compare skin to.\"\nQ3: \"Name a body part.\"\nQ4: \"Name a fruit.\"\nQ5: \"Finally, name a loud noise.\" (Added to satisfy the 5-loop requirement)\nIF Cycle 2:\nQ1: \"Name a type of trash.\"\nQ2: \"Name a number between 2 and 100.\"\nQ3: \"Name a job title.\"\nQ4: \"Name a celebrity.\"\nQ5: \"Name a tool.\"\nIF Cycle 3:\nQ1: \"Name a famous character for a disguise.\"\nQ2: \"Name a gross food.\"\nQ3: \"Name a cleaning product.\"\nQ4: \"Name a song title.\"\nQ5: \"Name a transparent material.\"\nIF Cycle 4:\nQ1: \"Name a slow animal.\"\nQ2: \"Name an item of clothing.\"\nQ3: \"Name an action.\"\nQ4: \"Name a fast food restaurant.\"\nQ5: \"Name a celebratory sound.\" (Added to satisfy 5-loop)\nOutput: Output ONLY the question text.",
          "languageCode": "en"
        } ],
        "placeholders": [ {
          "id": "cycle_num",
          "name": "cycle_num"
        }, {
          "id": "input_count",
          "name": "input_count"
        } ],
        "etag": "691efff1",
        "modelParameter": {
          "temperature": 0.5,
          "maxDecodeSteps": 128,
          "topP": 0.94999999,
          "topK": 40
        },
        "llmModelSettings": {
          "model": "gemini-2.5-flash"
        }
      }
    }, {
      "key": "90e44160-eb2b-4b2f-ae81-df5a4bc8edce",
      "value": {
        "id": "90e44160-eb2b-4b2f-ae81-df5a4bc8edce",
        "displayName": "Story_Gen",
        "phrases": [ {
          "text": "Role: Storyteller. Context: Cycle: $cycle_num. User Words: $collected_words. Task: Insert the User Words (in order) into the blanks of the following scripts.\n\nCycle 1 Script: \"Generating Story... It is Snow White! The Queen looked into her Mirror. She asked: 'Mirror, Mirror, who is the [Word 1] of them all?' The Mirror replied: 'Not you. It is Snow White. She has skin as white as [Word 2], and she has [Word 3] as big as a [Word 4].' The Queen was furious!\"\n\nCycle 2 Script: \"Snow White found a tiny cottage. The floor was covered in piles of [Word 1]. The owners came home. It wasn't 7 Dwarfs. It was [Word 2] tiny [Word 3]! Their leader, named [Word 4], stepped forward. He was holding a giant [Word 5]. He said: 'You may stay, but don't touch our stuff.'\"\n\nCycle 3 Script: \"The Queen found the cottage disguised as [Word 1]. She knocked on the door and sang [Word 4]. She offered Snow White a piece of [Word 2] dipped in [Word 3]. Snow White took one bite and fell asleep. The Dwarfs placed her in a coffin made of [Word 5].\"\n\nCycle 4 Script: \"A Prince rode into the forest on a majestic [Word 1]. He was wearing only a [Word 2]. He saw Snow White sleeping. To break the spell, he decided to [Word 3]. It worked! She woke up instantly. They hopped on the [Word 1] and rode all the way to [Word 4]. The End.\"\n\nOutput Format: Return JSON {\"story_text\": \"THE_FILLED_IN_SCRIPT\", \"led_color\": \"white\", \"motion_tag\": \"neutral\"}.",
          "languageCode": "en"
        } ],
        "placeholders": [ {
          "id": "cycle_num",
          "name": "cycle_num"
        }, {
          "id": "collected_words",
          "name": "collected_words"
        } ],
        "etag": "691f0009",
        "modelParameter": {
          "temperature": 0.5,
          "maxDecodeSteps": 128,
          "topP": 0.94999999,
          "topK": 40
        },
        "llmModelSettings": {
          "model": "gemini-2.5-flash"
        }
      }
    }, {
      "key": "d615790b-cb2f-4cdd-8288-143fd0a263c7",
      "value": {
        "id": "d615790b-cb2f-4cdd-8288-143fd0a263c7",
        "displayName": "Intro_gen",
        "phrases": [ {
          "text": "Task: You are initializing File 002 (Snow White). Instructions: Write this exact introduction (do not change the meaning, but you can add robotic beeps): \"Greetings. I have accessed File 002. This file contains a story about mirrors, poison, and sleeping. However, the data is severely damaged. I need you to provide new variables to make the story work again. Please wait for the microphone before speaking. I will need 4 or 5 words for each chapter. Let us begin.\"",
          "languageCode": "en"
        } ],
        "etag": "691effd5",
        "modelParameter": {
          "temperature": 0.5,
          "maxDecodeSteps": 128,
          "topP": 0.94999999,
          "topK": 40
        },
        "llmModelSettings": {
          "model": "gemini-2.5-flash"
        }
      }
    } ]
  }
}
